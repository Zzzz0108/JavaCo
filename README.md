# 聊天室系统

一个基于Java实现的多人聊天室系统，支持私聊、群聊、文本聊天、语音聊天、文件传输等功能。系统采用C/S架构，使用Socket进行网络通信，实现了实时消息传递、语音通话、文件共享等功能。

## 项目架构

### 服务器端架构
- 采用多线程设计，支持多客户端并发连接
- 使用Socket进行网络通信，支持TCP可靠传输
- 主要组件：
  - `ChatServerService`: 服务器核心服务类
    - 管理所有客户端连接
    - 处理消息转发
    - 维护用户在线状态
    - 管理群组信息
    - 处理文件传输
    - 保存聊天记录
  - `ChatGroup`: 群组管理类
    - 维护群组成员列表
    - 管理成员在线状态
    - 处理群组消息广播
    - 保存群组配置
  - `ClientConnection`: 客户端连接类
    - 管理单个客户端的Socket连接
    - 处理消息收发
    - 维护用户状态信息

### 客户端架构
- 基于Swing实现的图形界面，提供友好的用户交互
- 主要组件：
  - `ClientGUI`: 客户端主界面
    - 显示聊天消息
    - 提供用户操作界面
    - 管理群组和私聊窗口
    - 处理文件传输界面
  - `ClientController`: 客户端控制器
    - 管理与服务器的通信
    - 处理消息发送和接收
    - 维护本地用户状态
  - `VoiceChatService`: 语音聊天服务
    - 处理实时语音数据采集
    - 管理语音数据压缩
    - 控制语音数据发送和接收
    - 处理语音通话状态

## 功能特性

### 1. 用户管理
- 用户登录
  - 支持用户名和密码验证
  - 支持多设备登录
- 在线用户列表查看
  - 实时显示在线用户
  - 服务端显示用户在线状态
- 匿名聊天模式切换
  - 支持临时切换匿名身份
  - 保持消息历史记录
  - 不影响文件传输功能

### 2. 群组功能
- 创建群组
  - 自定义群组ID和名称
- 加入/退出群组
  - 通过群组ID加入
  - 支持主动退出
  - 保存群组历史记录
- 群组消息广播
  - 实时消息推送
  - 支持离线消息存储
  - 消息历史记录保存

### 3. 聊天功能
- 公共聊天
  - 所有在线用户可见
  - 消息实时推送
- 私聊
  - 一对一私密聊天
  - 独立聊天窗口
  - 消息加密传输
- 群组聊天
  - 群组内消息广播
  - 显示在线成员
- 消息历史记录
  - 自动保存聊天记录
  - 支持历史记录查看
- 离线消息存储
  - 自动保存离线消息
  - 登录后自动推送

### 4. 语音聊天
- 一对一语音通话
  - 实时语音传输
- 群组语音通话
  - 支持多人同时通话
- 实时语音传输

### 5. 文件传输
- 私聊文件传输
  - 支持任意类型文件
- 群组文件共享
  - 群组内文件共享
- 离线文件通知
  - 自动保存文件信息
  - 上线后自动提醒
- 文件下载管理
  - 自定义保存位置
  - 显示文件大小

## 使用方法

### 服务器启动
1. 环境要求
   - JDK 8或以上版本
   - 至少1GB可用内存
   - 稳定的网络连接
2. 运行服务器
   ```bash
   java -cp bin com.example.chatroom.server.ServerMain.java
   ```
3. 配置说明
   - 默认监听端口：8888
   - 可修改配置文件调整参数
   - 支持自定义日志级别
### 客户端使用
1. 启动客户端
   ```bash
   java -cp bin com.example.chatroom.client.ClientMain.java
   ```
2. 连接服务器
   - 输入服务器IP地址
   - 输入服务器端口
   - 点击连接按钮
3. 用户登录
   - 输入用户名
   - 输入密码
   - 点击登录按钮

- 如果想实现多台计算机聊天，需修改配置，启动唯一服务端，并将所有客户端统一修改服务器IP和端口
    - ![截屏2025-05-21 21.08.35.png](..%2F..%2F..%2F..%2Fvar%2Ffolders%2F72%2Fjcg4sx6j6_gd3660xz15g7tm0000gn%2FT%2FTemporaryItems%2FNSIRD_screencaptureui_UlA3kf%2F%E6%88%AA%E5%B1%8F2025-05-21%2021.08.35.png)
    - ![截屏2025-05-21 21.10.38.png](..%2F%E6%88%AA%E5%B1%8F2025-05-21%2021.10.38.png)

### 基本操作

#### 1. 发送消息
- 公共聊天
  - 在底部输入框输入消息
  - 按回车或点击发送按钮
  - 消息会显示在主聊天窗口
- 私聊
  - 从用户列表选择私聊对象
  - 在私聊窗口输入消息
  - 支持表情和图片发送
- 群组聊天
  - 选择目标群组
  - 在群组窗口输入消息
  - 支持@群组成员

#### 2. 群组操作
- 创建群组
  - 点击"创建群组"按钮
  - 输入群组ID和名称
  - 确认创建
- 加入群组
  - 点击"加入群组"按钮
  - 输入群组ID
  - 确认加入
- 退出群组
  - 选择要退出的群组
  - 点击"退出群组"按钮
  - 确认退出
- 查看群组
  - 点击"群组列表"按钮
  - 显示所有可用群组
  - 显示群组成员状态

#### 3. 语音聊天
- 私聊语音
  - 选择私聊对象
  - 点击"语音聊天"按钮
  - 等待对方接受
  - 开始语音通话
- 群组语音
  - 选择目标群组
  - 点击"群组语音"按钮
  - 等待成员加入
  - 开始群组通话

#### 4. 文件传输
- 发送文件
  - 选择接收者或群组
  - 点击"上传文件"按钮
  - 选择要发送的文件
  - 等待传输完成
- 接收文件
  - 收到文件通知
  - 选择保存位置
  - 等待下载完成
  - 查看文件信息

### 系统命令
- `@@list`: 查看在线用户列表
- `@@allusers`: 查看所有注册用户
- `@@groups`: 查看所有群组列表
- `@@anonymous`: 切换匿名聊天模式
- `@@create <群组ID> <群组名称>`: 创建新群组
- `@@join <群组ID>`: 加入指定群组
- `@@leave <群组ID>`: 退出指定群组

## 注意事项
1. 网络连接
   - 确保服务器和客户端网络连接正常
   - 建议使用稳定的网络环境
   - 支持自动重连机制
2. 语音聊天
   - 需要双方都接受请求
   - 确保麦克风权限正常
   - 建议使用耳机避免回声
3. 文件传输
   - 支持离线文件通知
   - 用户上线后可下载
   - 注意文件大小限制
4. 群组消息
   - 自动保存历史记录
   - 支持消息撤回
   - 显示发送状态
5. 匿名模式
   - 用户名会随机生成
   - 不影响文件传输
   - 保持消息历史

## 技术栈
- 开发语言：Java 8+
- 图形界面：Swing GUI
- 网络通信：Socket
- 并发处理：多线程
- 数据存储：文件IO
- 音频处理：JavaSound API
- 日志管理：SLF4J

## 常见问题
1. 连接失败
   - 检查服务器是否启动
   - 确认网络连接正常
   - 验证端口是否正确
2. 语音问题
   - 检查麦克风权限
   - 确认音频设备正常
   - 尝试重新连接
3. 文件传输
   - 检查磁盘空间
   - 确认文件权限
   - 验证网络状态
4. 群组问题
   - 确认群组ID正确
   - 检查成员权限
   - 验证群组状态

